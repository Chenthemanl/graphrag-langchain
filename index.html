<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Deep Researcher & Writing Assistant</title>
    <link rel="stylesheet" href="index.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="/index.css">
</head>
<body>
    <main id="app-container">
        <header>
            <h1>Deep Researcher &amp; Writing Assistant</h1>
            <p>Generate and refine a literature review from your own documents.</p>
        </header>

        <!-- Step 1: Add Content -->
        <section id="processing-section" class="card">
            <h2 class="card-title">1. Build Knowledge Base</h2>
            <div id="input-methods">
                 <div class="file-input-wrapper">
                    <input type="file" id="file-input" class="file-input-hidden" accept=".txt,.md,.text,.pdf" aria-label="Upload text or PDF files" multiple>
                    <label for="file-input" class="button-secondary">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="20" height="20">
                            <path d="M9 16h6v-6h4l-7-7-7 7h4v6zm-4 2h14v2H5v-2z"/>
                        </svg>
                        <span>Upload File(s) (.txt, .pdf)</span>
                    </label>
                    <span id="file-name-display" class="file-name-display"></span>
                </div>
                 <textarea id="article-input" placeholder="The content of your uploaded file will appear here... You can also paste text directly." rows="6" aria-label="Article Input"></textarea>
            </div>
            <button id="process-button" class="button-primary">Add to Knowledge Base</button>
            <div id="knowledge-base-container" class="hidden">
                <h3 class="knowledge-base-title">Knowledge Base</h3>
                <div id="knowledge-list">
                    <!-- Dynamically generated knowledge source cards will appear here -->
                </div>
            </div>
        </section>

        <!-- Step 2: Generate Literature Review -->
        <section id="literature-review-section" class="card hidden">
            <h2 class="card-title">2. Generate Literature Review</h2>
            <p class="section-description">Provide a topic, and the Deep Researcher will generate a draft by iteratively querying the knowledge base, inspired by the TTD-DR framework.</p>
            <form id="review-form">
                 <div class="review-options">
                    <span class="review-options-label">Review Length:</span>
                    <label for="review-detailed">
                        <input type="radio" id="review-detailed" name="review-length" value="detailed" checked>
                        Detailed
                    </label>
                    <label for="review-concise">
                        <input type="radio" id="review-concise" name="review-length" value="concise">
                        Concise
                    </label>
                </div>
                <div class="review-input-group">
                    <input type="text" id="review-topic-input" placeholder="Enter your literature review topic..." required aria-label="Literature review topic">
                    <button id="generate-review-button" class="button-primary" type="submit">Generate Review</button>
                </div>
            </form>
            <div id="review-generation-progress" class="hidden">
                <h3 class="progress-title">Generation Progress</h3>
                <div id="review-progress-log"></div>
                <div id="draft-display-container">
                    <div class="draft-header">
                        <h4 class="progress-subtitle">Review Draft</h4>
                        <div id="draft-version-controls">
                            <!-- Version buttons will be injected here by JS -->
                        </div>
                    </div>
                    <div id="review-draft-output" class="draft-output"></div>
                </div>
            </div>
        </section>

        <!-- Step 3: Refine with Writing Assistant -->
        <section id="writing-assistant-section" class="card hidden">
            <h2 class="card-title">3. Refine with Writing Assistant</h2>
            <div class="assistant-layout">
                <div class="editor-container">
                    <div class="editor-header">
                        <div class="editor-toolbar">
                             <button class="toolbar-button" data-command="bold" aria-label="Bold"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="18" height="18"><path d="M15.6 10.79c.97-.67 1.65-1.77 1.65-2.79 0-2.26-1.75-4-4-4H7v14h7.04c2.09 0 3.71-1.7 3.71-3.79 0-1.52-.86-2.82-2.15-3.42zM10 6.5h3c.83 0 1.5.67 1.5 1.5s-.67 1.5-1.5 1.5h-3v-3zm3.5 9H10v-3h3.5c.83 0 1.5.67 1.5 1.5s-.67 1.5-1.5 1.5z"/></svg></button>
                             <button class="toolbar-button" data-command="italic" aria-label="Italic"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="18" height="18"><path d="M10 4v3h2.21l-3.42 8H6v3h8v-3h-2.21l3.42-8H18V4z"/></svg></button>
                             <button class="toolbar-button" data-command="underline" aria-label="Underline"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="18" height="18"><path d="M12 17c3.31 0 6-2.69 6-6V3h-2.5v8c0 1.93-1.57 3.5-3.5 3.5S8.5 12.93 8.5 11V3H6v8c0 3.31 2.69 6 6 6zm-7 2v2h14v-2H5z"/></svg></button>
                             <div class="toolbar-divider"></div>
                             <button class="toolbar-button" data-command="insertUnorderedList" aria-label="Bulleted List"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="18" height="18"><path d="M4 10.5c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5zm0-6c-.83 0-1.5.67-1.5 1.5S3.17 7.5 4 7.5 5.5 6.83 5.5 6 4.83 4.5 4 4.5zm0 12c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5zM7 19h14v-2H7v2zm0-6h14v-2H7v2zm0-8v2h14V5H7z"/></svg></button>
                             <button class="toolbar-button" data-command="insertOrderedList" aria-label="Numbered List"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="18" height="18"><path d="M2 17h2v.5H3v1h1v.5H2v1h3v-4H2v1zm1-9h1V4H2v1h1v3zm-1 3h1.8L2 13.1v.9h3v-1H3.2L5 10.9V10H2v1zm5-6v2h14V5H7zm0 14h14v-2H7v2zm0-6h14v-2H7v2z"/></svg></button>
                        </div>
                        <button id="similarity-check-button" class="button-secondary similarity-button" aria-label="Check for Similarity">
                            <svg xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 24 24" viewBox="0 0 24 24" fill="currentColor" width="18" height="18"><g><path d="M14,2H6C4.9,2,4,2.9,4,4v16c0,1.1,0.9,2,2,2h12c1.1,0,2-0.9,2-2V8L14,2z M16,18H8v-2h8V18z M16,14H8v-2h8V14z M13,9V3.5 L18.5,9H13z"/><path d="M14.17,10.42c-0.29-0.19-0.59-0.35-0.9-0.48C13.62,9.6,14,9.01,14,8.32c0-1.01-0.82-1.83-1.83-1.83 c-1.01,0-1.83,0.82-1.83,1.83c0,0.68,0.38,1.28,0.94,1.58c-0.31,0.14-0.61,0.3-0.9,0.49c-1.3,0.85-2.17,2.37-2.17,4.09h1.5 c0-1.42,0.89-2.67,2.17-3.24c0.4-0.18,0.83-0.32,1.26-0.32s0.86,0.14,1.26,0.32c1.28,0.57,2.17,1.82,2.17,3.24h1.5 C16.33,12.78,15.47,11.26,14.17,10.42z M12.17,8.82c0.28,0,0.5-0.22,0.5-0.5s-0.22-0.5-0.5-0.5s-0.5,0.22-0.5,0.5S11.89,8.82,12.17,8.82 z"/></g></svg>
                            <span>Check for Similarity</span>
                        </button>
                    </div>

                    <div id="writing-editor" class="editor" contenteditable="true" aria-label="Writing editor"></div>
                     <div id="references-container" class="hidden">
                        <h3>References</h3>
                        <div id="references-list"></div>
                    </div>
                </div>
                <div class="suggestions-container">
                    <div class="suggestions-header">
                        <h3>AI Suggestions</h3>
                        <button id="analyze-text-button" class="button-secondary" aria-label="Analyze Text">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="18" height="18"><path d="M18.99 12.01c0 4.2-3.71 6.47-3.71 6.47s-3.71-2.27-3.71-6.47c0-2.06 1.66-3.72 3.71-3.72s3.71 1.66 3.71 3.72zm-7.42-3.72L10.1 6.82l-1.47 1.47-1.47-1.47-1.47 1.47-1.47-1.47-1.47 1.47 1.47 1.47-1.47 1.47 1.47 1.47 1.47-1.47 1.47 1.47 1.47-1.47 1.47-1.47zm7.42 9.21l1.47 1.47 1.47-1.47 1.47 1.47 1.47-1.47 1.47 1.47-1.47 1.47 1.47 1.47-1.47 1.47-1.47-1.47-1.47 1.47-1.47-1.47-1.47 1.47z"/></svg>
                            <span>Analyze Text</span>
                        </button>
                    </div>
                    <div id="suggestions-panel">
                        <div class="placeholder">Click "Analyze Text" to get suggestions.</div>
                    </div>
                </div>
            </div>
        </section>


        <!-- Q&A Section (Kept as a separate tool) -->
        <section id="qa-section" class="card hidden">
            <h2 class="card-title">Quick Q&A</h2>
            <div id="chat-container">
                <!-- Chat messages will be dynamically added here -->
            </div>
            <form id="chat-form">
                <input type="text" id="question-input" placeholder="Ask a quick question about the content..."
                    autocomplete="off" aria-label="Question Input" disabled>
                <button type="submit" class="button-primary" aria-label="Send message" disabled>
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="20" height="20">
                        <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"></path>
                    </svg>
                </button>
            </form>
        </section>

    </main>

    <div id="loader" class="hidden">
        <div class="spinner"></div>
        <p>Processing...</p>
    </div>

    <script type="importmap">
      {
        "imports": {
          "@google/genai": "https://esm.sh/@google/genai@^0.7.0",
          "pdfjs-dist": "https://esm.sh/pdfjs-dist@4.4.168/build/pdf.mjs"
        }
      }
    </script>
    <script type="module" src="index.tsx"></script>
<script type="module" src="/index.tsx"></script>
</body>
</html>